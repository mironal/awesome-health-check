{"version":3,"sources":["contextMenu.ts","background.ts"],"names":[],"mappings":"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","file":"background.js","sourceRoot":"../src","sourcesContent":["import { UpdateProgressMessage } from \"./message\"\n\nexport type ContextMenuState = \"initial\" | \"started\" | \"finished\"\n\nexport const contextMenuIds = {\n  progress: \"context_menu_id_progress\",\n  start: \"context_menu_id_check_health\",\n  cancel: \"context_menu_id_cancel\",\n}\n\nexport const initializeContextMenu = () => {\n  chrome.contextMenus.create({\n    id: contextMenuIds.progress,\n    title: \"Waiting start...\",\n    contexts: [\"page_action\"],\n    type: \"normal\",\n    enabled: false,\n  })\n  chrome.contextMenus.create({\n    id: contextMenuIds.start,\n    title: \"Start check health\",\n    contexts: [\"page_action\"],\n  })\n\n  chrome.contextMenus.create({\n    id: contextMenuIds.cancel,\n    title: \"Cancel\",\n    contexts: [\"page_action\"],\n    type: \"normal\",\n    enabled: false,\n  })\n}\n\nexport const updateContextMenu = (state: ContextMenuState) => {\n  switch (state) {\n    case \"initial\":\n      chrome.contextMenus.update(contextMenuIds.progress, {\n        enabled: false,\n      })\n      chrome.contextMenus.update(contextMenuIds.start, {\n        enabled: true,\n      })\n      chrome.contextMenus.update(contextMenuIds.cancel, {\n        enabled: false,\n      })\n      break\n    case \"started\":\n      chrome.contextMenus.update(contextMenuIds.progress, {\n        enabled: false,\n      })\n      chrome.contextMenus.update(contextMenuIds.start, {\n        enabled: false,\n      })\n      chrome.contextMenus.update(contextMenuIds.cancel, {\n        enabled: true,\n      })\n      break\n    case \"finished\":\n      chrome.contextMenus.update(contextMenuIds.progress, {\n        enabled: false,\n      })\n      chrome.contextMenus.update(contextMenuIds.start, {\n        enabled: false,\n      })\n      chrome.contextMenus.update(contextMenuIds.cancel, {\n        enabled: true,\n      })\n  }\n}\n\nexport const updateProgress = (data: UpdateProgressMessage[\"data\"]) => {\n  chrome.contextMenus.update(contextMenuIds.progress, {\n    title: `Remaining ${data.remaining}, Total: ${data.total}`,\n  })\n}\n","import {\n  StartCheckMessage,\n  BackgroundMessages,\n  CancelCheckMessage,\n} from \"./message\"\nimport {\n  initializeContextMenu,\n  updateProgress,\n  contextMenuIds,\n  updateContextMenu,\n} from \"./contextMenu\"\n\nconst processMessage = (\n  msg: BackgroundMessages,\n  sender: chrome.runtime.MessageSender,\n  responseFn: (response?: any) => void,\n) => {\n  if (msg.type === \"update_progress\") {\n    updateProgress(msg.data)\n    if (chrome.runtime.lastError) {\n      console.error(chrome.runtime.lastError)\n      responseFn(chrome.runtime.lastError)\n    } else {\n      responseFn()\n    }\n  } else if (msg.type === \"change_icon_visibility\") {\n    if (msg.data.visible) {\n      chrome.pageAction.show(sender.tab!.id!)\n    } else {\n      chrome.pageAction.hide(sender.tab!.id!)\n    }\n  } else if (msg.type === \"finish_check\") {\n    updateContextMenu(\"finished\")\n  }\n}\n\nchrome.runtime.onInstalled.addListener(() => {\n  initializeContextMenu()\n})\n\nchrome.runtime.onMessage.addListener((msg, sender, sendResp) => {\n  processMessage(msg, sender, sendResp)\n  return true\n})\n\nchrome.runtime.onSuspend.addListener(() => console.log(\"onSuspend\"))\n\nchrome.contextMenus.onClicked.addListener((menu, tab) => {\n  if (!tab) {\n    return\n  }\n  if (menu.menuItemId === contextMenuIds.start) {\n    const msg: StartCheckMessage = {\n      type: \"start_check\",\n    }\n    chrome.tabs.sendMessage(tab.id!, msg, () => updateContextMenu(\"started\"))\n  } else if (menu.menuItemId === contextMenuIds.cancel) {\n    const msg: CancelCheckMessage = {\n      type: \"cancel_check\",\n    }\n    chrome.tabs.sendMessage(tab.id!, msg, () => updateContextMenu(\"initial\"))\n  }\n})\n"]}